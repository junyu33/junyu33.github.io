<!DOCTYPE html>
<html lang="zh">

  
    <link rel="alternate" hreflang="en" href="/en/2021/08/10/xp/">
  

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css">
  <!-- RSS / Atom -->
  <link rel="alternate" type="application/atom+xml" title="RSS" href="/atom.xml">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
  <script>hljs.highlightAll();</script>

  
<link rel="stylesheet" href="/css/style.css">

  <title>现充|junyu33</title>
<meta name="generator" content="Hexo 7.3.0"></head>

<body>
  <div class="head-nav">
	<div class="inner">
		<a href="/">
			现充|junyu33
		</a>
		<div class="right">
			
				<a href="/zh">首页</a>
				<a href="/zh/archives">归档</a>
				
					<a href="/zh/categories">分类</a>
				
				
					<a href="/zh/tags">标签</a>
				
				<a href="/">English</a>
			
		</div>
	</div>
</div>

  <div class="main">
    <div class="post">
    
      <nav class="lang-switch" role="navigation" aria-label="Language switch">
        
          <a class="lang-pill"
             href="/en/2021/08/10/xp/"
             hreflang="en">
            <span class="lang-label">English</span>
          </a>
        
      </nav>
    

	<h1>Xposed——从入门到放弃</h1>
	<p>换新手机后，经过两天的不懈努力（与50元解bootloader锁的智商税？）我终于让华为的手机成了我的手机。</p>
<span id="more"></span>
<img src="https://img.junyu33.me/blog/xp/1.png" style="zoom: 33%;" />
<p>目前还没发现有什么特别的用处，等以后<strong>有技术了</strong>再来填坑。</p>
<h2 id="updated-on-2024-8-17">updated on 2024-8-17</h2>
<p>这段时间比较空闲，于是我终于有时间来填坑了。</p>
<p>首先我要说的是，我感觉 root 后能做的事情比我想象得少很多。毕竟这个手机的安卓版本是 7.0，已经被时代给抛弃了。</p>
<p>以下的事情有些不用 root 也能搞定，但比较 hack 的操作我也会写在下面。</p>
<h3 id="卸载系统应用（成功）">卸载系统应用（成功）</h3>
<p>首先使用 <a target="_blank" rel="noopener" href="https://www.myandroidtools.com/">MyAndroidTools</a> 并不能正常卸载（即使拿到了 root 权限），原因未知。</p>
<p>正确的做法是拿到包名后使用 root 权限进入 shell，然后键入以下命令：</p>
<pre><code class="language-sh">adb shell pm uninstall --user 0 &lt;package_name&gt;
</code></pre>
<p>笔者通过对比 MyAndroidTools 前后应用的列表差别，确认这个是永久卸载，而不是高版本 Android 只在当前用户删除。</p>
<h3 id="System-RW（失败）">System RW（失败）</h3>
<p>笔者在新国大坐牢，曾经在 Ubuntu 笔记本搞 Waydroid 的时候，意外地发现了 SystemRW （<a target="_blank" rel="noopener" href="http://www.systemrw.com">www.systemrw.com</a>，不用点，已经挂了）这个工具。我曾使用这个工具成功使我的 Waydroid 的 system 分区可写，从而有了愉快的网络抓包经历。</p>
<p>如今，这个工具的官网已经挂了，但它的解压文件还乖乖躺在了我的电脑里。于是我熟练的将它 push 到了手机上，然后运行了它。结果如下：</p>
<pre><code class="language-sh">HWSTF:/data/local/tmp/sysrw_1.41 # ./sysrw

 ---------------------------------------------------
|  Welcome to the one and only original, universal  |
|===================================================|
|        SystemRW / SuperRW v1.41 featuring         |
|          MakeRW / ro2rw v1.1 by lebigmac          |
|===================================================|
|(read-only-2-read/write SUPER partition converter) |
|---------------------------------------------------|
|Also known as System-RW/Vendor-RW/Product-RW/Odm-RW|
|   FORCE-RW, TRUE-RW, EROFS-RW, F2FS-RW, EXT4-RW,  |
| THE REAL RW, FULL-RW, ERWFS, F2FS-2-RW-CONVERTER, |
|EROFS-2-RW-CONVERTER, Super Flasher/Resizer/Patcher|
| Root enhancer, Full Root, Real Root &amp; more aliases|
|---------------------------------------------------|
|Inspiring a whole generation of talented developers|
|     and empowering the open source community.     |
|     The prophecy has finally been fullfilled!     |
|The Pandora's Box has been fully unlocked at last! |
|Let the Olympic System Modding Games (OASMG) begin!|
| The power is now in YOUR hands! And do not forget:|
|    With great power comes great responsibility!   |
|---------------------------------------------------|
|  CREDITS: @lebigmac @Brepro1 @Kolibass @Yuki1001  |
| Shoutouts: harpreet.s, frxhb, HemanthJabalpuri    |
|===================================================|
|    OFFICIAL HOMEPAGE @ http://www.systemrw.com    |
|===================================================|
|You can use this software for free for educational,|
| personal, non-commercial, legal purposes. To use  |
|this software for commercial purposes,please rent a|
| commercial usage license @ the official link above|
|---------------------------------------------------|
|   WARNING! NEVER TRUST THE SOFTWARE OF THIEVES!   |
|This project (or parts thereof) was stolen, hacked |
|    and/or abused by brigudav, leegarchat &amp; co!    |
|dr-ketan steal my unique System-RW name from me :( |
|---------------------------------------------------|
|Always download original System-RW from link above!|
|---------------------------------------------------|
|You can learn from my code but please do not steal,|
| hack, crack or abuse it in any way! Thank you! &lt;3 |
 ---------------------------------------------------
sysrw: Custom exclude detected: &quot; odm product system_dlkm system_ext vendor vendor_dlkm &quot;
sysrw: Backups enabled
sysrw: Initiating procedure...

sysrw: Device is in Android mode
sysrw: Current device: HUAWEI 
sysrw: Current device architecture: aarch64
sysrw: Please install Android 10 or newer and try again
</code></pre>
<blockquote>
<p>这个 developer 还是有点中二的，你说对不对？</p>
</blockquote>
<p>很不幸，这个工具只支持 Android 10 以上的版本。我之前也尝试进 fastboot 模式刷了一个 Android 13 的 ROM，但是这个 ROM 有点问题，导致我无法进入系统。所以这个方法暂时不可行。</p>
<h3 id="尝试将-magisk-root-方法换成-kernelSU（失败）">尝试将 magisk root 方法换成 kernelSU（失败）</h3>
<p>显然，我认为 kernelSU 是一个更加 advanced 的 root 方法。或许可以解决 <code>/system</code> 分区不可写的问题。</p>
<p>然而：</p>
<blockquote>
<p>KernelSU officially supports Android GKI 2.0 devices (kernel 5.10+). Older kernels (4.14+) are also compatible, but the kernel will have to be built manually.</p>
</blockquote>
<pre><code class="language-sh">HWSTF:/ # uname -a
Linux localhost 4.1.18-g7bd0d96 #1 SMP PREEMPT Fri Oct 12 10:15:13 CST 2018 aarch64
</code></pre>
<p>显然，我的手机的内核版本是 4.1.18，所以这个方法也不可行。</p>
<h3 id="将我的-shizuku-更换为-sui（失败）">将我的 shizuku 更换为 sui（失败）</h3>
<p>shizuku 在它的应用里说 sui 将最终取代 shizuku，于是我尝试安装 sui。</p>
<p>但是，我试了 github 诸多版本的 sui（zygisk），它们的安装包在我的的手机上都无法解析。个人猜测应该是 Android 版本问题。只好作罢。</p>
<h3 id="安装-Ubuntu（成功）">安装 Ubuntu（成功）</h3>
<p>最理想的情况是直接裸机安装 Ubuntu，但据 misane 的说法，ubuntu touch 支持的手机型号很少。另外，手机的驱动是闭源的，而且不一定在 Linux 内核层，有可能在安卓 HAL 层，所以就难办。</p>
<p>于是我只好退而求其次，在 Termux 上安装 Ubuntu。最新版的 Termux 在我的设备上无法安装，我找到的可用于 7.0 的版本是 0.88。</p>
<p>然后，我参照<a target="_blank" rel="noopener" href="https://blog.csdn.net/xyzAriel/article/details/104698491">这个教程</a>在 Termux 上配置好环境并安装了 Ubuntu，其实感觉功能并不比 Termux 本身强多少。</p>
<pre><code class="language-sh">apt-get update
apt-get upgrade -y
apt-get install wget proot git -y
termux-setup-storage
git clone https://github.com/MFDGaming/ubuntu-in-termux.git
cd ubuntu-in-termux
chmod +x ubuntu.sh
./ubuntu.sh -y
# start
./startubuntu.sh
</code></pre>
<blockquote>
<p>另外这里的清华源地址有错，正确的 Termux 源是 <code>deb https://mirrors.tuna.tsinghua.edu.cn/termux/apt/termux-main stable main</code>。</p>
<p>另外，安装也不需要几个小时，开了代理，最多一分钟。</p>
</blockquote>
<p>BTW，用手机敲命令真的很难受，于是我在手机上装了个 OpenSSH，从电脑端来操作。</p>
<blockquote>
<p>这里启动 sshd 服务不需要 systemctl 那一套，直接 <code>sshd</code> 就行。</p>
</blockquote>
<h3 id="防止杀后台（成功）">防止杀后台（成功）</h3>
<p>我问了下 ChatGPT，他推荐了 App Systemizer，看了下 GitHub，这个工具最后一次更新还是7年前，支持 Magisk v14（我的版本是 27）。GitHub 没有提供安装包，而 Magisk 目前也不提供搜索模块的功能。于是我只能去 <a target="_blank" rel="noopener" href="https://xdaforums.com/t/module-terminal-app-systemizer-v17-3-1.3585851/">XDA</a> 找到最新版本的压缩包（2019年），往 Magisk 里一丢，安装成功。</p>
<p>至于 Magisk 怎么安装离线 zip 包，这里简单讲一下：模块 -&gt; 从本地安装 -&gt; 选择 RE/MT 文件管理器 -&gt; 选择 zip 包即可。至于使用方法参考 XDA 链接里的 youtube 视频即可。</p>
<p>另外，我也可以通过使屏幕保持常亮来防止后台被杀，但因为未知原因，设置里面的休眠选项是灰色的，无法更改。根据 ChatGPT 的回答，它说你可以使用 ADB 或 root 权限直接修改安卓系统的 settings 数据库，来调整休眠时间。具体命令如下：</p>
<pre><code class="language-sh">adb shell settings put system screen_off_timeout 2147483647
</code></pre>
<p>我试了下，确实管用。设置这边这个值变成“永不”了。于是，这个旧手机离变成树莓派已经不远了。</p>
<h3 id="hack-系统主题（成功）">hack 系统主题（成功）</h3>
<p>我觉得我旧手机的系统主题挺好看的，想迁移到自己现在的主力机上。我在旧手机的主题商店得知这个主题的名字叫“再见时光”，然后在主力机上一搜，找不到这个主题。</p>
<p>于是我参考了<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/av340138233/">这个链接</a>得知华为的主题包后缀名是<code>hwt</code>，但路径与视频中的不同，于是我选择：</p>
<pre><code class="language-sh">find / -name &quot;*.hwt&quot; 2&gt;/dev/null
</code></pre>
<p>部分输出如下：</p>
<pre><code>./system/emui/china/themes/Droidsansfallback.hwt                                              
./system/emui/china/themes/FZLT.hwt                                                           
./system/emui/china/themes/FZLTH.hwt                                                          
./storage/emulated/0/HWThemes/.cache/Rhapsody.hwt                                             
./storage/emulated/0/HWThemes/.cache/Flow.hwt                                                 
./storage/emulated/0/HWThemes/.cache/Memento.hwt                                              
./storage/emulated/0/HWThemes/.cache/Serenade.hwt                                             
./storage/emulated/0/HWThemes/.cache/Symphony.hwt                                             
./storage/emulated/0/HWThemes/.cache/Waltz.hwt                                                
./storage/emulated/0/HWThemes/.cache/Droidsansfallback.hwt                                    
./storage/emulated/0/HWThemes/.cache/FZLT.hwt                                                 
./storage/emulated/0/HWThemes/.cache/FZLTH.hwt                                                
./storage/emulated/0/HWThemes/.cache/cover/onlinethemepreview/73E071837FEE1E3023D3BE4E1C725237.hwt
./storage/emulated/0/HWThemes/.cache/cover/onlinethemepreview/b7e06a7ad1d2468082d4bcf11f1d158f.hwt
./storage/emulated/0/HWThemes/.cache/cover/onlinethemepreview/20170322172846.62772498.hwt     
./storage/emulated/0/HWThemes/.cache/cover/onlinethemepreview/20170331163957.18140689.hwt     
./storage/emulated/0/HWThemes/.cache/cover/onlinethemepreview/628834ba702c488ebde3a43777795a7d.hwt
./storage/emulated/0/HWThemes/.cache/cover/onlinethemepreview/1FCE0D891DD45D68F7E67399E1499281.hwt
./storage/emulated/0/HWThemes/.cache/cover/onlinethemepreview/CF0193A7174829B27F8D8465E3231170.hwt
./storage/emulated/0/HWThemes/.cache/20170331163957.18140689.hwt                               
./storage/emulated/0/HWThemes/.cache/b7e06a7ad1d2468082d4bcf11f1d158f.hwt                     
./storage/emulated/0/HWThemes/.cache/628834ba702c488ebde3a43777795a7d.hwt                      
./storage/emulated/0/HWThemes/20170331163957.18140689.hwt                                     
./storage/emulated/0/HWThemes/b7e06a7ad1d2468082d4bcf11f1d158f.hwt                             
./storage/emulated/0/HWThemes/628834ba702c488ebde3a43777795a7d.hwt
</code></pre>
<p>于是主题的路径是<code>/storage/emulated/0/HWThemes</code>，然后查看<code>.cache</code>目录，ls 一下：</p>
<pre><code class="language-sh">HWSTF:/storage/emulated/0/HWThemes/.cache # ls
20170331163957.18140689.hwt          Flow.hwt     Waltz.hwt                            
628834ba702c488ebde3a43777795a7d.hwt Memento.hwt  b7e06a7ad1d2468082d4bcf11f1d158f.hwt 
Droidsansfallback.hwt                Rhapsody.hwt cover                                
FZLT.hwt                             Serenade.hwt diycache                             
FZLTH.hwt                            Symphony.hwt themecache
</code></pre>
<p>这里面每一个都是文件夹，内部都有一个名为<code>description.xml</code>的文件，查看这个文件就可以得知主题的名称，例如：</p>
<pre><code class="language-sh">HWSTF:/storage/emulated/0/HWThemes/.cache # cat b7e06a7ad1d2468082d4bcf11f1d158f.hwt/description.xml
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;

&lt;HwTheme&gt;
    &lt;title&gt;bye lyh&lt;/title&gt;
    &lt;title-cn&gt;再见时光&lt;/title-cn&gt;
    &lt;author&gt;云海&lt;/author&gt;
    &lt;designer&gt;云海&lt;/designer&gt;
    &lt;screen&gt;FHD&lt;/screen&gt;
    &lt;version&gt;5.0.0&lt;/version&gt;
    &lt;font&gt;Default&lt;/font&gt;
    &lt;font-cn&gt;默认&lt;/font-cn&gt;
    &lt;briefinfo&gt;【限时免费】需要壁纸的请加微信公众号：YHtheme 回复 壁纸下载 ，或加QQ100750086，备注华为主题锁屏是动态锁屏，会有花瓣树叶等飘落，已适配海量图标，拨号界面，联系人，短信列表等界面。
&lt;/briefinfo&gt;
&lt;/HwTheme&gt;




HWSTF:/storage/emulated/0/HWThemes/.cache # 
</code></pre>
<p>于是我们得知，应该将 <code>b7e06a7ad1d2468082d4bcf11f1d158f.hwt</code> 这个文件夹 pull 出来，这就算成功一半了。</p>
<p>接着，我应该将<code>HWThemes</code>目录的这个<code>hwt</code>文件拷贝到主力机上，自然，路径跟旧手机肯定又不一样。我们知道，此时的华为主题商店已经变成了荣耀主题商店，于是对应的路径是<code>/storage/emulated/0/Honor/Themes</code>，里面有<code>themecache</code>这个文件夹，因此可以基本确定把<code>hwt</code>文件放在这个路径下就可以了。</p>
<p>我如法炮制，打开主力机的荣耀主题商店，“我的主题”里面果然就有了这个，甚至还能看这个主题的用户评论。</p>
<blockquote>
<p>看来华为荣耀还是没有彻底分家啊。</p>
</blockquote>
<p>可能是因为屏幕长宽比不同，这个主题适配到主力机上锁屏界面有点瑕疵，短信界面也无法显示背景。但除此之外还是挺完美的。</p>
<h3 id="绿色守护（成功）">绿色守护（成功）</h3>
<p>针对 Android 7 能用的旧版本绿色守护是在<a target="_blank" rel="noopener" href="http://shouyou.kuai8.com/game/60585.html">这里</a>找到的。我启用了 root 功能，但工作模式中的 Xposed 模式不能选择，原因未知。</p>
<p>出于隐私保护，我休眠了除 NCalc+ 和 termux 外所有的联网应用，除此之外我没有做其他操作。</p>
<h3 id="frida-初探（成功）">frida 初探（成功）</h3>
<p>首先我在 GitHub 上找到了 magisk-frida，在 Xposed 安装了 zip 包。然后在我的 Ubuntu 主机配置 frida client，步骤如下：</p>
<pre><code class="language-sh">conda create -n frida python=3.11
conda activate frida
pip3 install frida frida-tools
</code></pre>
<p>然后运行：</p>
<pre><code class="language-sh">adb forward tcp:27042 tcp:27042
frida-ps -U
</code></pre>
<p>可以看到手机上的进程。</p>
<pre><code class="language-sh">  PID  Name
-----  ------------------------------------------
12346  Clash Meta for Android
 1575  Gboard
19507  Google Play 商店
  498  HwCamCfgSvr
  509  HwServiceHost
16389  Magisk
12938  MyAndroidTools
 1932  SIM 卡应用
18117  Via
12080  adbd
 2256  android.process.acore
12014  android.process.media
  552  audioserver
  485  bastetd
  500  cameraserver
  516  chargemonitor
 1570  com.android.bluetooth
19319  com.android.defcontainer
 2588  com.android.incallui
 2748  com.android.nfc
19294  com.android.packageinstaller
19231  com.android.providers.calendar
19681  com.android.vending:background
 6247  com.bidau.nkngl
18285  com.github.metacubex.clash.meta
 2523  com.google.android.ext.services
 2637  com.google.android.gms
 2292  com.google.android.gms.persistent
11716  com.google.android.gms.unstable
19209  com.google.android.webview:webview_service
11682  com.google.process.gapps
 1910  com.huawei.android.chr
 2190  com.huawei.android.instantshare
 2830  com.huawei.android.launcher
 6480  com.huawei.android.pushagent.PushService
 2652  com.huawei.bd
...
</code></pre>
<h4 id="com-bidau-nkngl">com.bidau.nkngl</h4>
<p>这里有一个叫<code>com.bidau.nkngl</code>的进程，我觉得这个进程很可疑，通过手机的 MyAndroidTools 得知这个应用的名字叫<code>SystemStars</code>，Apk路径为<code>/system/app/MTExMSxodW/MTExMSxodWF3ZWktc3RmLWFsMDAsNjU1OTUsMQ==.apk</code>，base64解一下得到<code>1111,hu/1111,huawei-stf-al00,65595,1</code>，感觉没什么意思。于是我又决定用 frida 来看看这个应用的行为，具体的我还是查看与网络相关的行为：</p>
<p>首先枚举与网络相关的类：</p>
<pre><code class="language-javascript">Java.perform(function() &#123;
    Java.enumerateLoadedClasses(&#123;
        onMatch: function(className) &#123;
            if (className.includes(&quot;okhttp&quot;) || className.includes(&quot;http&quot;) || className.includes(&quot;network&quot;)) &#123;
                console.log(&quot;Loaded class: &quot; + className);
            &#125;
        &#125;,
        onComplete: function() &#123;
            console.log(&quot;Class enumeration complete.&quot;);
        &#125;
    &#125;);
&#125;);
</code></pre>
<p>结果如下：</p>
<pre><code>Attaching...                                                                                                                                                                16:15:52 [120/187]
Loaded class: org.apache.http.HttpEntityEnclosingRequest
Loaded class: org.apache.http.ProtocolVersion
Loaded class: org.apache.http.HttpResponse
Loaded class: org.apache.http.impl.cookie.DateParseException
Loaded class: org.apache.http.message.AbstractHttpMessage
Loaded class: org.apache.http.HeaderIterator
Loaded class: org.apache.http.HttpHost
Loaded class: org.apache.http.params.AbstractHttpParams
Loaded class: org.apache.http.message.BasicHeader
Loaded class: org.apache.http.StatusLine
Loaded class: org.apache.http.client.methods.HttpUriRequest
Loaded class: org.apache.http.conn.ClientConnectionManager
Loaded class: org.apache.http.HttpEntity
Loaded class: org.apache.http.Header
Loaded class: org.apache.http.client.HttpClient
Loaded class: org.apache.http.NameValuePair
Loaded class: org.apache.http.message.BasicStatusLine
Loaded class: org.apache.http.message.BasicHttpResponse
Loaded class: org.apache.http.impl.cookie.DateUtils
Loaded class: org.apache.http.client.ResponseHandler
Loaded class: org.apache.http.client.methods.HttpEntityEnclosingRequestBase
Loaded class: org.apache.http.client.methods.AbortableHttpRequest
Loaded class: org.apache.http.client.methods.HttpRequestBase
Loaded class: org.apache.http.HttpVersion
Loaded class: org.apache.http.HttpRequest
Loaded class: org.apache.http.HttpMessage
Loaded class: org.apache.http.client.utils.URLEncodedUtils
Loaded class: org.apache.http.client.methods.HttpPost
Loaded class: org.apache.http.entity.BasicHttpEntity
Loaded class: org.apache.http.message.HeaderGroup
Loaded class: org.apache.http.params.BasicHttpParams
Loaded class: org.apache.http.protocol.HttpContext
Loaded class: org.apache.http.entity.AbstractHttpEntity
Loaded class: org.apache.http.params.HttpConnectionParams
Loaded class: org.apache.http.params.CoreConnectionPNames
Loaded class: org.apache.http.params.HttpParams
Loaded class: org.apache.http.conn.ConnectTimeoutException
Loaded class: com.android.okhttp.internal.http.HttpTransport
Loaded class: com.android.okhttp.Headers
Loaded class: com.android.okhttp.internal.tls.OkHostnameVerifier
Loaded class: com.android.okhttp.internal.http.RequestException
Loaded class: com.android.okhttp.internal.huc.HttpsURLConnectionImpl
Loaded class: com.android.okhttp.Connection
Loaded class: com.android.okhttp.ConnectionSpec
Loaded class: com.android.okhttp.internal.http.CacheStrategy
Loaded class: com.android.okhttp.internal.http.HttpMethod
Loaded class: com.android.okhttp.internal.huc.HttpURLConnectionImpl
Loaded class: com.android.okhttp.internal.OptionalMethod
Loaded class: com.android.okhttp.ConnectionPool$1
Loaded class: com.android.okhttp.internal.Util
Loaded class: com.android.okhttp.OkHttpClient$1
Loaded class: com.android.okhttp.internal.Network$1
Loaded class: com.android.okhttp.internal.http.HttpConnection$ChunkedSource
Loaded class: com.android.okhttp.RequestBody
Loaded class: com.android.okhttp.Headers$Builder
Loaded class: com.android.okhttp.CacheControl$Builder
Loaded class: com.android.okhttp.HttpUrl
Loaded class: com.android.okhttp.HttpHandler$CleartextURLFilter
Loaded class: com.android.okhttp.internal.http.OkHeaders$1
Loaded class: com.android.okhttp.okio.AsyncTimeout$1
Loaded class: com.android.okhttp.CertificatePinner$Builder
Loaded class: com.android.okhttp.Route
Loaded class: com.android.okhttp.Handshake
Loaded class: com.android.okhttp.okio.AsyncTimeout$2
Loaded class: com.android.okhttp.okio.BufferedSink
Loaded class: com.android.okhttp.internal.http.RouteException
Loaded class: com.android.okhttp.internal.http.Transport
Loaded class: com.android.okhttp.okio.RealBufferedSink$1
Loaded class: com.android.okhttp.Dispatcher
Loaded class: com.android.okhttp.okio.RealBufferedSink
Loaded class: com.android.okhttp.internal.http.OkHeaders
Loaded class: com.android.okhttp.internal.http.HttpEngine
Loaded class: com.android.okhttp.internal.http.HttpConnection$FixedLengthSource
Loaded class: com.android.okhttp.internal.Util$1
Loaded class: com.android.okhttp.Request
Loaded class: com.android.okhttp.okio.Source
Loaded class: com.android.okhttp.okio.RealBufferedSource$1
Loaded class: com.android.okhttp.TlsVersion
Loaded class: com.android.okhttp.HttpUrl$Builder$ParseResult
Loaded class: com.android.okhttp.OkUrlFactory
Loaded class: com.android.okhttp.okio.Timeout$1
Loaded class: com.android.okhttp.okio.ForwardingTimeout
Loaded class: com.android.okhttp.internal.Network
Loaded class: com.android.okhttp.internal.http.StatusLine
Loaded class: com.android.okhttp.internal.Internal
Loaded class: com.android.okhttp.internal.ConnectionSpecSelector
Loaded class: com.android.okhttp.CipherSuite
Loaded class: com.android.okhttp.HttpHandler
Loaded class: com.android.okhttp.ConnectionSpec$Builder
Loaded class: com.android.okhttp.Address
Loaded class: com.android.okhttp.ConfigAwareConnectionPool$1
Loaded class: com.android.okhttp.internal.http.HttpConnection$AbstractSource
Loaded class: com.android.okhttp.ConfigAwareConnectionPool
Loaded class: com.android.okhttp.okio.Timeout
Loaded class: com.android.okhttp.ConnectionPool
Loaded class: com.android.okhttp.okio.RealBufferedSource
Loaded class: com.android.okhttp.okio.SegmentPool
Loaded class: com.android.okhttp.okio.BufferedSource
Loaded class: com.android.okhttp.okio.Okio
Loaded class: com.android.okhttp.okio.Okio$1
Loaded class: com.android.okhttp.Response$Builder
Loaded class: com.android.okhttp.internal.http.RequestLine
Loaded class: com.android.okhttp.internal.http.RouteSelector
Loaded class: com.android.okhttp.okio.Okio$2
Loaded class: com.android.okhttp.ResponseBody
Loaded class: com.android.okhttp.okio.Okio$3
Loaded class: com.android.okhttp.Authenticator
Loaded class: com.android.okhttp.Response
Loaded class: com.android.okhttp.internal.http.RetryableSink
Loaded class: com.android.okhttp.HttpsHandler
Loaded class: com.android.okhttp.Protocol
Loaded class: com.android.okhttp.okio.Segment
Loaded class: com.android.okhttp.internal.huc.DelegatingHttpsURLConnection
Loaded class: com.android.okhttp.okio.Util
Loaded class: com.android.okhttp.okio.AsyncTimeout
Loaded class: com.android.okhttp.RequestBody$2
Loaded class: com.android.okhttp.okio.Sink
Loaded class: com.android.okhttp.internal.http.CacheStrategy$Factory
Loaded class: com.android.okhttp.CertificatePinner
Loaded class: com.android.okhttp.internal.RouteDatabase
Loaded class: com.android.okhttp.internal.http.HttpEngine$1
Loaded class: com.android.okhttp.HttpUrl$Builder
Loaded class: com.android.okhttp.internal.http.RealResponseBody
Loaded class: com.android.okhttp.internal.URLFilter
Loaded class: com.android.okhttp.internal.http.HttpConnection
Loaded class: com.android.okhttp.okio.AsyncTimeout$Watchdog
Loaded class: com.android.okhttp.internal.Platform
Loaded class: com.android.okhttp.CacheControl
Loaded class: com.android.okhttp.Request$Builder
Loaded class: com.android.okhttp.OkHttpClient
Loaded class: com.android.okhttp.internal.http.AuthenticatorAdapter
Loaded class: com.android.okhttp.okio.Buffer
Loaded class: [Lcom.android.okhttp.HttpUrl$Builder$ParseResult;
Loaded class: [Lorg.apache.http.Header;
Loaded class: [Lcom.android.okhttp.Protocol;
Loaded class: [Lcom.android.okhttp.ConnectionSpec;
Loaded class: [Lcom.android.okhttp.TlsVersion;
Loaded class: [Lcom.android.okhttp.CipherSuite;
Class enumeration complete.
</code></pre>
<p>可见其用了 <code>org.apache.http</code> 和 <code>com.android.okhttp</code> 这两个库，于是我们可以编写 hook 代码，这里以 <code>OkHttp</code> 的 <code>Request</code> 和 <code>Response</code> 为例：</p>
<pre><code class="language-javascript">Java.perform(function() &#123;
    var OkHttpRequestBuilder = Java.use('com.android.okhttp.Request$Builder');

    OkHttpRequestBuilder.build.implementation = function() &#123;
        var request = this.build();
        var url = request.url().toString();
        console.log(&quot;[OkHttp] Request URL: &quot; + url);

        // Print headers
        var headers = request.headers();
        for (var i = 0; i &lt; headers.size(); i++) &#123;
            console.log(&quot;[OkHttp] Header: &quot; + headers.name(i) + &quot;: &quot; + headers.value(i));
        &#125;

        return request;
    &#125;;

    var OkHttpClient = Java.use('com.android.okhttp.OkHttpClient');
    OkHttpClient.newCall.overload('com.android.okhttp.Request').implementation = function(request) &#123;
        console.log(&quot;[OkHttp] Making request to: &quot; + request.url().toString());
        return this.newCall(request);
    &#125;;
&#125;);
</code></pre>
<p>然后运行：</p>
<pre><code class="language-sh">frida -U -n com.bidau.nkngl -l monitor_network.js
</code></pre>
<p>然后发现报错了，<code>frida-server</code>并没有在运行。于是我只好乖乖地去GitHub上下载了一份对应版本的<code>frida-server</code>，然后 push 到手机上，再启动服务端。</p>
<pre><code class="language-sh">HWSTF:/data/local/tmp # ./frida-server-16.4.8-android-arm64 
unable to stat file for the executable &quot;/memfd:frida-helper-32 (deleted)&quot;: No such file or directory
^CHWSTF:/data/local/tmp # 
</code></pre>
<p>这次再运行脚本，登了一段时间，并没有任何输出：</p>
<pre><code class="language-sh">&gt; frida -U -n com.bidau.nkngl -l monitor_network.js

     ____
    / _  |   Frida 16.4.8 - A world-class dynamic instrumentation toolkit
   | (_| |
    &gt; _  |   Commands:
   /_/ |_|       help      -&gt; Displays the help system
   . . . .       object?   -&gt; Display information about 'object'
   . . . .       exit/quit -&gt; Exit
   . . . .
   . . . .   More info at https://frida.re/docs/home/
   . . . .
   . . . .   Connected to STF AL10 (id=xxx)
                                                                                
[STF AL10::com.bidau.nkngl ]-&gt;
</code></pre>
<p>于是我选择了速度更快的静态分析，使用 jadx-gui 打开 apk 文件，根据今年六月份的实训经验，java 代码的业务逻辑基本都在<code>service</code>这个类中，于是我打开<code>com.nantu.nengl.service.MyLocalService</code>，找到了如下一段代码：</p>
<pre><code class="language-java">    public boolean a(List&lt;com.nantu.nengl.a.b&gt; list) &#123;
        if (list == null || list.size() == 0) &#123;
            return true;
        &#125;
        JSONObject jSONObject = new JSONObject();
        try &#123;
            jSONObject.put(&quot;action&quot;, &quot;openAppLogFromShuaji&quot;);
            JSONObject jSONObject2 = new JSONObject();
            jSONObject2.put(&quot;imei&quot;, com.nantu.nengl.c.d.a(this));
            jSONObject2.put(&quot;appverCode&quot;, f.a().a(this));
            jSONObject2.put(&quot;channelid&quot;, f.f45a);
            jSONObject2.put(&quot;imsi&quot;, com.nantu.nengl.c.d.b(this));
            jSONObject2.put(&quot;androidver&quot;, Build.VERSION.SDK_INT);
            JSONArray jSONArray = new JSONArray();
            for (int i = 0; i &lt; list.size(); i++) &#123;
                com.nantu.nengl.a.b bVar = list.get(i);
                if (bVar != null) &#123;
                    JSONObject jSONObject3 = new JSONObject();
                    jSONObject3.put(&quot;p&quot;, bVar.b());
                    jSONObject3.put(&quot;m&quot;, bVar.c());
                    jSONObject3.put(&quot;nf&quot;, bVar.d());
                    jSONObject3.put(&quot;o&quot;, bVar.a());
                    jSONArray.put(jSONObject3);
                &#125;
            &#125;
            jSONObject2.put(&quot;applist&quot;, jSONArray);
            b.b(&quot;sendActiveApp l = &quot; + jSONArray.toString());
            jSONObject.put(&quot;data&quot;, com.nantu.nengl.c.a.a(jSONObject2.toString(), &quot;SJ@WWW.7TU.CN_AM&quot;));
            return com.nantu.nengl.c.c.a(jSONObject.toString());
        &#125; catch (JSONException e) &#123;
            e.printStackTrace();
            return false;
        &#125; catch (Exception e2) &#123;
            e2.printStackTrace();
            return false;
        &#125;
    &#125;
</code></pre>
<p>原来这是我之前给手机安装的一个名为“奇兔刷机”的应用，这个应用现在都还躺在我的recovery分区里，感觉应该是没什么问题的。</p>
<h4 id="com-android-vending">com.android.vending</h4>
<p>但是我总得通过什么东西来证明 frida 的能力对吧，于是我选择了 play 商店，包名是 <code>com.android.vending</code>，hook脚本不变。</p>
<p>但这次运行却出错了：</p>
<pre><code class="language-sh">&gt; frida -U -n com.android.vending -l monitor_network.js

     ____
    / _  |   Frida 16.4.8 - A world-class dynamic instrumentation toolkit
   | (_| |
    &gt; _  |   Commands:
   /_/ |_|       help      -&gt; Displays the help system
   . . . .       object?   -&gt; Display information about 'object'
   . . . .       exit/quit -&gt; Exit
   . . . .
   . . . .   More info at https://frida.re/docs/home/
   . . . .
   . . . .   Connected to STF AL10 (id=xxx)
Failed to spawn: unable to find process with name 'com.android.vending'
</code></pre>
<p>这个问题其实也不难解决，只需要拿到 play 商店的 pid，然后用 pid 进行 hook 也未尝不可，然后在 play 商店随便刷新几下就有结果了：</p>
<pre><code class="language-sh">&gt; frida -U -p 19507 -l monitor_network.js

     ____
    / _  |   Frida 16.4.8 - A world-class dynamic instrumentation toolkit
   | (_| |
    &gt; _  |   Commands:
   /_/ |_|       help      -&gt; Displays the help system
   . . . .       object?   -&gt; Display information about 'object'
   . . . .       exit/quit -&gt; Exit
   . . . .
   . . . .   More info at https://frida.re/docs/home/
   . . . .
   . . . .   Connected to STF AL10 (id=xxx)

[STF AL10::PID::19507 ]-&gt; [OkHttp] Header: Host: play.googleapis.com                                          
[OkHttp] Header: Connection: Keep-Alive                                                        
[OkHttp] Header: Accept-Encoding: gzip                                                               
[OkHttp] Header: Content-Length: 7913                                       
[OkHttp] Request URL: https://play.googleapis.com/play/log?format=raw&amp;proto_v2=true             
[OkHttp] Header: Content-Encoding: gzip                                                             
[OkHttp] Header: Content-Type: application/x-gzip                                                    
[OkHttp] Header: User-Agent: Android-Finsky/42.2.27-23%20%5B0%5D%20%5BPR%5D%20660620715                                 
[OkHttp] Header: Authorization: Bearer ya29.m.CpYCAdJUhWdHMq07ko1_QNsNqX0-6Z-sSqLuep-11xDbDzGwmbv40T_07xA6gzicGOdtIRL6BdTI5JroLxax1-PsRCElhVFFthKPXEmG2AR12LAVPlHI8JmLjVh5mxng7oEE2qQroDGusu5RruzqkIFOQu06qFBCr......................................................................................................................................................0SWQyTtdD0blEqv--9e6-yV3gR6vGOXROTIRWhCCdS2LF7phuO84eAXRjx6kkM-YSDwgBEgcKAQQQjeoEGMHNBBogVmnWzORig8HgDXTx0_LY_IwnqMpxpyfFd9kGW0AYE_IiAggBKithQ2dZS0FTQVNBUk1TRlFIR1gyTWlaT25kXzQ0anJwSjZHaklHMUxtSFBB
...
</code></pre>
<p>完结撒花。</p>
<h2 id="updated-on-2025-7-28">updated on 2025-7-28</h2>
<p>又过了将近一年，我的旧手机终于在尝试给app抓包时起到了作用——然并没有解决我遇到的问题，具体内容见<a href="https://blog.junyu33.me/2025/07/28/router.html">此链接</a>。</p>
<h2 id="updated-on-2025-11-26（如何零成本解bl锁）">updated on 2025-11-26（如何零成本解bl锁）</h2>
<p>距离这台手机（STF-AL10）解锁已经过去了四年多的时间，先前只有相关人士知道的某些关键信息也逐渐在网上流传，现在已经可以做到零成本解bl锁了。步骤如下：</p>
<ol>
<li>拆开手机后盖，用镊子短接下面的触点（另一端放在金属上即可），此时手机便进入了 9008/EDL 模式。短接后用USB连接电脑，设备管理器更新 <code>HUAWEI USB COM 1.0</code>（也有可能是 <code>USB SER</code>，反正检测到更新 diff 一下即可）就可松开镊子。</li>
</ol>
<img src='https://img.junyu33.me/blog/xp/2.png'>
<ol start="2">
<li>GitHub 上有一个强制向麒麟处理器硬件写入解锁码的工具 <a target="_blank" rel="noopener" href="https://github.com/mashed-potatoes/PotatoNV">PotatoNV</a>，支持<code>620 650 655 658 659 925 935 950 960</code>型号。STF-AL10 的处理器是麒麟 960，PotatoNV 刚好是支持的最后一代。具体操作按照给出的链接 README 进行操作即可，工具的大致原理就是检测到 9008 模式的设备后给设备注入一个随机的解锁码，从而手动输入该解锁码解锁。</li>
<li>使用 <code>fastboot oem unlock YOUR_CODE_HERE</code> 命令或<a target="_blank" rel="noopener" href="https://www.downxia.com/downinfo/181026.html">华为专用解锁工具</a>进行解锁。</li>
</ol>
<p>虽然手机解锁之后可以使用对应的<a target="_blank" rel="noopener" href="https://xdaforums.com/t/openkirin-beta-stf-twrp-3-1-1-1-update-28-10-2017.3654355/">TWRP</a>进行卡刷，也可以刷 Magisk 进行 root。但如果想要换一个 OS 的话，由于年代过于久远，目前基本找不到支持手机上的 EMUI5.1 (Android 7) 的 ROM。如果你想体验 lineage 等类原生 android，可以参考<a target="_blank" rel="noopener" href="https://www.caiwen.work/post/huawei_honor_9#sheng-ji-dao-emui-8">这篇文章</a>将手机升级支持到 Project Treble 的 EMUI 版本（例如 EMUI 9），再进行线刷。<s>总之，最后你会发现官方的才是最好的，并刷回官方的系统。</s></p>

</div>


  </div>
</body>
</html>

