<!DOCTYPE html>
<html lang="zh">

  
    <link rel="alternate" hreflang="en" href="/en/2022/03/07/pwn_environ/">
  

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css">
  <!-- RSS / Atom -->
  <link rel="alternate" type="application/atom+xml" title="RSS" href="/atom.xml">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
  <script>hljs.highlightAll();</script>

  
<link rel="stylesheet" href="/css/style.css">

  <title>现充|junyu33</title>
<meta name="generator" content="Hexo 7.3.0"></head>

<body>
  <div class="head-nav">
	<div class="inner">
		<a href="/">
			现充|junyu33
		</a>
		<div class="right">
			
				<a href="/zh">首页</a>
				<a href="/zh/archives">归档</a>
				
					<a href="/zh/categories">分类</a>
				
				
					<a href="/zh/tags">标签</a>
				
				<a href="/">English</a>
			
		</div>
	</div>
</div>

  <div class="main">
    <div class="post">
    
      <nav class="lang-switch" role="navigation" aria-label="Language switch">
        
          <a class="lang-pill"
             href="/en/2022/03/07/pwn_environ/"
             hreflang="en">
            <span class="lang-label">English</span>
          </a>
        
      </nav>
    

	<h1>如何打造一个究极舒适的pwn环境</h1>
	<p>如果能把精力集中在shellcode的编写上，而不是一遍又一遍地在虚拟机和vscode中来回横跳，那是多么惬意的事情。</p>
<p>我们假设读者刚刚装好了vscode，里面什么插件也没有，从零开始。</p>
<p>整个过程大概需要花费半天到一天的时间。</p>
<p>成果图：</p>
<img src="https://img.junyu33.me/blog/pwn_environ/show.png">
<span id="more"></span>
<h1>linux系统的搭建与shell美化</h1>
<h2 id="方法一：使用虚拟机（推荐）">方法一：使用虚拟机（推荐）</h2>
<p>个人推荐从kali官网上下载虚拟机版本，这样安装就是导入几分钟的事情，可以少走许多弯路。</p>
<p>并且安装好后，系统本身安装的包就基本够用了，什么python3、pip、gdb、ssh都是预置好的的，非常方便。</p>
<p>系统自带的终端zsh颜值还不错，也不需要过多的配置。</p>
<h2 id="方法二：使用wsl-wsl2">方法二：使用wsl/wsl2</h2>
<p>如果你的windows内部版本小于18362，那么我并不推荐你选择这种方法，因为之前的版本只能安装wsl，而且wsl不是真正的linux内核。具体一点，你不能运行32位程序。</p>
<p>如果你的windows内部版本小于19041，那么安装wsl2会开启Hyper-V，会导致与Vmware虚拟机产生冲突，因此个人也不推荐。</p>
<blockquote>
<p>for experienced: 如果你之前装了wsl，可以参考这篇升级指南：<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/356397851">https://zhuanlan.zhihu.com/p/356397851</a></p>
</blockquote>
<p>我的系统内部版本是18363，因此安装了wsl，这里以安装wsl为例进行介绍。</p>
<h3 id="启用wsl并下载linux子系统">启用wsl并下载linux子系统</h3>
<p>win10设置——更新与安全——开发者选项——开发人员模式</p>
<p>win+q——启用或关闭windows功能——重启</p>
<p>去微软应用商店自行下载一个linux发行版即可，我选择的是ubuntu18.04</p>
<p><strong>记得装好后第一件事就是换源。</strong></p>
<p>学会在vim中生存下来。</p>
<p>如果你有魔法，建议装一个proxychains以免去git clone时的痛苦。</p>
<h3 id="更改并美化linux终端（可选）">更改并美化linux终端（可选）</h3>
<p>主要分为以下三步：</p>
<ol>
<li>
<p>安装zsh</p>
</li>
<li>
<p>安装oh-my-zsh</p>
</li>
<li>
<p>在oh-my-zsh中配置Powerlevel9k主题</p>
</li>
</ol>
<p>（这几步够你喝一壶了）</p>
<p>参考链接：</p>
<p><a target="_blank" rel="noopener" href="https://www.thisfaner.com/p/powerlevel9k-zsh/#powerlevel9k-%E7%AE%80%E4%BB%8B">https://www.thisfaner.com/p/powerlevel9k-zsh/#powerlevel9k-简介</a></p>
<p><a target="_blank" rel="noopener" href="https://www.sysgeek.cn/install-zsh-shell-ubuntu-18-04/">https://www.sysgeek.cn/install-zsh-shell-ubuntu-18-04/</a></p>
<h2 id="设置共享文件夹">设置共享文件夹</h2>
<h3 id="vmware">vmware</h3>
<p>右键虚拟机——设置——选项——共享文件夹——总是启用——添加路径</p>
<p>在kali中：共享文件的路径是<code>/mnt/hgfs</code></p>
<p>如果是直接导入的kali，那么就不需要挂载操作。</p>
<p>否则参考这篇文章：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/wuhongbin/p/14052984.html">https://www.cnblogs.com/wuhongbin/p/14052984.html</a></p>
<h3 id="wsl">wsl</h3>
<p>直接在<code>/mnt/</code>中就可以看到主机的所有盘符，无需共享。</p>
<h1>在linux中配置pwn环境</h1>
<h2 id="在-linux-中使用-IDA-pro-updated-on-4-29-2023">在 linux 中使用 IDA pro (updated on 4/29/2023)</h2>
<blockquote>
<p>如果有钱买 linux 正版可以略过此节。</p>
<p>ref: <a target="_blank" rel="noopener" href="https://www.debugwar.com/article/activate-IDAPython-with-wine-IDA-under-linux">https://www.debugwar.com/article/activate-IDAPython-with-wine-IDA-under-linux</a></p>
</blockquote>
<p>相信大部分读者应该有 IDA pro 7.7 的学习版，只不过是 Windows 版本。让 linux 环境跑起 IDA pro 的步骤如下（以 ubuntu 22.04.2 LTS为例）：</p>
<ol>
<li>下载 <code>winehq</code>，选择<code>stable-branch</code>即可： <a target="_blank" rel="noopener" href="https://wiki.winehq.org/Ubuntu">https://wiki.winehq.org/Ubuntu</a></li>
<li>使用 <code>wine</code> 运行一次 <code>ida.exe/ida64.exe</code>，此时 ida 会提示没有 python 环境。</li>
<li>建议下载 <code>python3.8.10</code>的绿色包：<code>wget https://www.python.org/ftp/python/3.8.10/python-3.8.10-embed-amd64.zip</code>，并放置于 wine 对应 windows 分区的 <code>C:\Program Files\Python3</code>（即 linux 分区的 <code>~/.wine/drive_c/Program Files/Python3</code>）。</li>
<li>在 windows 注册表中将3中路径添加到<code>PATH</code>中，即<code>HKEY_LOCAL_MACHINE\System\CurrentControlSet\Control\Session Manager\Environment</code>中的<code>PATH</code>键值。</li>
<li>将<code>C:\Program Files\Python3\python38.dll</code>添加至<code>HKEY_CURRENT_USER\Software\Hex-Rays</code>中的<code>Python3TargetDLL</code>键值（如果没有就创建）</li>
<li>此时打开<code>IDA</code>应该可以用<code>IDAPython</code>，但是<code>yara keystone</code>相关插件仍会报错。这是因为我们没有用<code>pip</code>安装相关模块。</li>
<li>执行 <code>pip</code> 安装脚本：<code>wine python https://bootstrap.pypa.io/get-pip.py</code>并在<code>Python3</code>目录中的<code>python38._pth</code>文件中添加一行<code>./Lib/site-packages</code>，此时执行<code>wine python.exe -m pip --version</code>应回显<code>pip</code>版本。</li>
<li><code>wine python -m pip install yara-python keystone-engine six</code></li>
<li>（可选）将<code>pip</code>加入<code>PATH</code>（<code>C:\Program Files\Python3\Scripts</code>），加入chatGPT插件<code>gepetto.py</code>（需安装<code>openai</code>模块），配置主题文件等。</li>
<li>不要运行<code>idapyswitch.exe</code>，容易前功尽弃。</li>
</ol>
<h2 id="编写shellcode所需工具">编写shellcode所需工具</h2>
<ol>
<li>安装python，版本建议在3.6~3.10之间。</li>
<li>安装最新版的pip。</li>
<li>安装pwntools。</li>
</ol>
<h2 id="调试工具">调试工具</h2>
<ol>
<li>
<p>安装gdb。（建议把gcc和g++也装上）</p>
</li>
<li>
<p>安装gdb的插件peda、gef与pwndbg。(我是用gdbplugins项目打包安装的)</p>
</li>
<li>
<p>因为这三个插件不能共存，因此需要写一个启选择脚本或者记住这三个插件的启动方式。</p>
<blockquote>
<p>选择脚本：<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/94a71af2022a">https://www.jianshu.com/p/94a71af2022a</a></p>
<p>或者在~/.gdbinit中编辑:</p>
</blockquote>
<pre><code class="language-bash">source ~/GdbPlugins/gef/gef.py
#source ~/GdbPlugins/pwndbg/gdbinit.py
#source ~/GdbPlugins/peda/peda.py
</code></pre>
<blockquote>
<p>想用哪个去掉哪个注释即可。</p>
</blockquote>
</li>
</ol>
<h1>配置vscode远程链接</h1>
<p>比较麻烦而且坑比较多，请务必做好心理准备。</p>
<h2 id="在linux下配置ssh">在linux下配置ssh</h2>
<p>kali应该自带的，不必额外安装。</p>
<p><code>sudo apt-get install ssh</code></p>
<p><code>vim /etc/ssh/sshd_config</code>中<code>PermitRootLogin</code>改为<code>yes</code></p>
<p><code>service ssh start</code></p>
<h3 id="配置端口（可选）">配置端口（可选）</h3>
<p><code>vim /etc/ssh/sshd_config</code></p>
<blockquote>
<p>vim的find命令是在normal模式中输入<code>/</code>，然后输入<code>#port</code>，因为vim默认是完全匹配并区分大小写。</p>
<p>（如果你不知道什么是normal模式，请你多按几次esc键）</p>
</blockquote>
<p>默认端口22，想改就把注释去掉。</p>
<h2 id="在windows下配置ssh">在windows下配置ssh</h2>
<p>建议装个git，自带ssh。</p>
<p>其余配置与linux相仿。</p>
<h3 id="windows环境测试">windows环境测试</h3>
<p>打开你的终端，输入：</p>
<p><code>ssh kali@&lt;your outer ip in kali&gt; -p &lt;your modified port&gt;</code>（对于kali虚拟机）</p>
<p><code>ssh &lt;your name&gt;@localhost -p &lt;your modified port&gt;</code>（对于wsl）</p>
<p>如果输入密码正确，进入了linux的终端，就代表配置成功了。</p>
<h3 id="配置SSH-key（可选）">配置SSH key（可选）</h3>
<p>如果你不想输密码，可以通过部署一对SSH key解决问题。（原理跟部署博客是一样的）</p>
<p>可以参考这篇文章：<a target="_blank" rel="noopener" href="https://blog.csdn.net/andriodhahaha/article/details/104809303">https://blog.csdn.net/andriodhahaha/article/details/104809303</a></p>
<h2 id="vscode-ssh插件配置">vscode ssh插件配置</h2>
<p>搜索<code>remote - SSH</code>，安装后点击边上多出的<code>Remote Explorer</code>菜单。</p>
<p>点击加号，把之前输入终端的ssh命令再输一遍，就可以坐等vscode在远端安卓vscode server了。</p>
<h3 id="坑点一——bad-owner-or-permissions-on-ssh-config">坑点一——bad owner or permissions on /.ssh/config</h3>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/chaoenhu/article/details/103698804">https://blog.csdn.net/chaoenhu/article/details/103698804</a></p>
<h3 id="坑点二——vscode-server安装过程中好像卡住不动了">坑点二——vscode server安装过程中好像卡住不动了</h3>
<p>类似于这样：</p>
<img src="https://img.junyu33.me/blog/pwn_environ/fake_error.png">
<p>其实它并没有卡死，它早就安装完了。我们只需要点击右上角的加号，新建一个终端即可。</p>
<h3 id="在vscode-server上安装插件（可选）">在vscode server上安装插件（可选）</h3>
<p>跟在本地安插件的过程相仿，只是你需要点击的是<code>install on 192.168.xxx.xxx/127.0.0.1</code>，别安到本地去了。</p>
<h3 id="常见问题——updated-on-3-25-2022">常见问题——updated on 3/25/2022</h3>
<p>vscode的pylance插件可能识别不出pwntools中的一些函数而产生警告，可以采用以下步骤忽略警告：</p>
<ol>
<li>
<p>Ctrl+Shift+P，输入settings.json</p>
</li>
<li>
<p>你会来到一个settings界面，不要管里面有什么内容。在你的<strong>远端ip</strong>的设置中找到<code>edit in setting.json</code>这个选项，点进去。</p>
</li>
<li>
<p>在最后一个大括号的上一行添加如下代码：</p>
<pre><code class="language-json">   &quot;python.analysis.diagnosticSeverityOverrides&quot;: &#123;
        &quot;reportUndefinedVariable&quot;: &quot;none&quot;
   &#125;
</code></pre>
</li>
</ol>
<p>vscode的pylance插件还可能会因为<code>sendline</code>系列函数，大段大段地报<code>code is unreachable</code>这个错误，修改方法如下：</p>
<p>查看sendline的源码，修改以下部分</p>
<pre><code class="language-python">    def send_raw(self, data):
        &quot;&quot;&quot;send_raw(data) Should not be called directly. Sends data to the tube. Should return ``exceptions.EOFError``, if it is unable to send any more, because of a close tube. &quot;&quot;&quot;

        raise EOFError('Not implemented')
</code></pre>
<p>将<code>raise EOFError('Not implemented')</code>改为<code>raise NotImplementedError</code>即可。</p>
<h2 id="vscode界面微调">vscode界面微调</h2>
<p>在<strong>非编辑区域</strong>右键即可调整。</p>
<p><strong>做完这些事情后，我们就可以开始愉快地coding啦！</strong></p>

</div>


  </div>
</body>
</html>

